<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

<th:block th:fragment="kapcsolat_form">

    <!--
       th:object="${kapcsolat_form_params}" -> A Controller által átadott DTO objektum.
       Ez kezeli az értékek visszatöltését hiba esetén.
    -->
    <form th:action="@{/kapcsolat}" method="POST" th:object="${kapcsolat_form_params}">

        <!-- SIKERES ÜZENET (Flash attribute vagy Model attribute) -->
        <div th:if="${success_msg}" class="alert alert-success" role="alert" th:text="${success_msg}"></div>

        <!-- GLOBÁLIS HIBAÜZENET -->
        <div th:if="${error_msg}" class="alert alert-danger" role="alert" th:text="${error_msg}"></div>

        <div class="row g-3">

            <!-- NÉV MEZŐ -->
            <div class="col-md-6">
                <label for="name" class="form-label d-none">Név</label>

                <!-- BEJELENTKEZVE: Automatikus kitöltés + letiltva -->
                <div sec:authorize="isAuthenticated()">
                    <!-- Hidden input a kötéshez (hogy elküldje az értéket) -->
                    <input type="hidden" name="name" th:value="${#authentication.name}">
                    <!-- Megjelenített disabled input -->
                    <input type="text"
                           class="form-control border border-secondary rounded ps-2 py-2 me-3"
                           placeholder="Név*"
                           th:value="${#authentication.name}"
                           disabled>
                </div>

                <!-- VENDÉG: Szerkeszthető mező -->
                <div sec:authorize="!isAuthenticated()">
                    <input type="text"
                           class="form-control border border-secondary rounded ps-2 py-2 me-3"
                           id="name"
                           placeholder="Név*"
                           th:field="*{name}"
                           th:classappend="${#fields.hasErrors('name')} ? 'is-invalid'">
                </div>

                <!-- Validációs hiba -->
                <div class="text-danger small mt-1" th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Hiba</div>
            </div>

            <!-- EMAIL MEZŐ -->
            <div class="col-md-6">
                <label for="email" class="form-label d-none">Email</label>

                <!-- BEJELENTKEZVE -->
                <div sec:authorize="isAuthenticated()">
                    <!--
                         Megjegyzés: A 'principal.email' csak akkor működik,
                         ha a UserDetails implementációdban van 'email' mező és getter.
                         Ha a username az email, akkor használd a ${#authentication.name}-et itt is.
                    -->
                    <input type="hidden" name="email" th:value="${#authentication.principal.email}">
                    <input type="text"
                           class="form-control border border-secondary rounded ps-2 py-2 me-3"
                           placeholder="Email*"
                           th:value="${#authentication.principal.email}"
                           disabled>
                </div>

                <!-- VENDÉG -->
                <div sec:authorize="!isAuthenticated()">
                    <input type="text"
                           class="form-control border border-secondary rounded ps-2 py-2 me-3"
                           id="email"
                           placeholder="Email*"
                           th:field="*{email}"
                           th:classappend="${#fields.hasErrors('email')} ? 'is-invalid'">
                </div>

                <!-- Validációs hiba -->
                <div class="text-danger small mt-1" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Hiba</div>
            </div>

            <!-- TELEFON MEZŐ -->
            <div class="col-12">
                <label for="phone" class="form-label d-none">Telefon</label>
                <input type="text"
                       class="form-control border border-secondary rounded ps-2 py-2 me-3"
                       id="phone"
                       placeholder="Telefon"
                       th:field="*{phone}"
                       th:classappend="${#fields.hasErrors('phone')} ? 'is-invalid'">
                <div class="text-danger small mt-1" th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}">Hiba</div>
            </div>

            <!-- TÁRGY MEZŐ -->
            <div class="col-12">
                <label for="subject" class="form-label d-none">Tárgy</label>
                <input type="text"
                       class="form-control border border-secondary rounded ps-2 py-2 me-3"
                       id="subject"
                       placeholder="Tárgy*"
                       th:field="*{subject}"
                       th:classappend="${#fields.hasErrors('subject')} ? 'is-invalid'">
                <div class="text-danger small mt-1" th:if="${#fields.hasErrors('subject')}" th:errors="*{subject}">Hiba</div>
            </div>

            <!-- ÜZENET MEZŐ -->
            <div class="col-12">
                    <textarea class="form-control border border-secondary rounded ps-2 py-2 me-3"
                              style="height:150px;"
                              id="message"
                              placeholder="Üzenet*"
                              th:field="*{message}"
                              th:classappend="${#fields.hasErrors('message')} ? 'is-invalid'"></textarea>
                <div class="text-danger small mt-1" th:if="${#fields.hasErrors('message')}" th:errors="*{message}">Hiba</div>
            </div>

            <!-- KÜLDÉS GOMB -->
            <div class="col-12 d-grid">
                <button type="submit" class="btn btn-primary btn-lg text-uppercase btn-rounded-none">Küldés</button>
            </div>
        </div>
    </form>
</th:block>

</body>
</html>
