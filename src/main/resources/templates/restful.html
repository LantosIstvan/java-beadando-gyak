<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default_layout}">
<head>
    <title>Restful API Kezel≈ë</title>
</head>
<body>

<div layout:fragment="content">
    <div class="container mt-4">
        <h2 class="mb-4">üõí K√©szletkezel√©s (REST API Demo)</h2>

        <!-- ≈∞RLAP -->
        <div class="card shadow-sm mb-5">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">√öj √°ru felv√©tele</h5>
            </div>
            <div class="card-body">
                <form id="aruForm">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="nev" class="form-label">Term√©k neve</label>
                            <input type="text" class="form-control" id="nev" required>
                        </div>
                        <div class="col-md-3">
                            <label for="ar" class="form-label">√År (Ft)</label>
                            <input type="number" class="form-control" id="ar" required>
                        </div>
                        <div class="col-md-3">
                            <label for="egyseg" class="form-label">Egys√©g</label>
                            <select id="egyseg" class="form-select">
                                <option value="kg">kg</option>
                                <option value="db">db</option>
                                <option value="l">liter</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-success w-100">Ment√©s</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- LISTA -->
        <h4 class="mb-3">Aktu√°lis K√©szlet</h4>
        <div id="aruLista" class="row">
            <!-- Ide t√∂lti be a JavaScript a k√°rty√°kat -->
            <div class="col-12 text-center text-muted">
                <div class="spinner-border" role="status"></div>
                <p>Adatok bet√∂lt√©se...</p>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <!-- Mivel ez a content r√©sze, a layoutban a body v√©g√©re ker√ºl, vagy ahol a content van -->
    <script>
        // Oldal bet√∂lt√©sekor fut le
        document.addEventListener("DOMContentLoaded", function() {
            refreshList();
        });

        // √Åruk lek√©r√©se (GET)
        function refreshList() {
            fetch('/api/aruk')
                .then(response => response.json())
                .then(data => {
                    let htmlContent = '';
                    if(data.length === 0) {
                        htmlContent = '<div class="alert alert-info">Nincs megjelen√≠thet≈ë √°ru az adatb√°zisban.</div>';
                    } else {
                        data.forEach(aru => {
                            // Figyelj: a Java entity mez≈ënevei itt teveP√∫pos (camelCase) form√°ban j√∂nnek √°t!
                            // Teh√°t aru_kod helyett val√≥sz√≠n≈±leg aruKod
                            let id = aru.aruKod || aru.aru_kod || aru.id;

                            htmlContent += `
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">${aru.nev}</h5>
                                            <h6 class="card-subtitle mb-2 text-muted">${aru.ar} Ft / ${aru.egyseg}</h6>
                                            <p class="card-text"><small>Azonos√≠t√≥: ${id}</small></p>
                                        </div>
                                        <div class="card-footer bg-white border-top-0">
                                            <button onclick="deleteProduct(${id})" class="btn btn-outline-danger btn-sm w-100">T√∂rl√©s</button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    document.getElementById('aruLista').innerHTML = htmlContent;
                })
                .catch(error => console.error('Hiba:', error));
        }

        // √öj √°ru ment√©se (POST)
        document.getElementById('aruForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const ujAru = {
                nev: document.getElementById('nev').value,
                ar: document.getElementById('ar').value,
                egyseg: document.getElementById('egyseg').value,
                katKod: 1  // <--- FONTOS: Ide √≠rj be egy l√©tez≈ë kateg√≥ria ID-t az adatb√°zisodb√≥l!
            };

            fetch('/api/aruk', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(ujAru)
            })
                .then(response => {
                    if (response.ok) {
                        document.getElementById('aruForm').reset();
                        refreshList(); // Lista friss√≠t√©se azonnal
                    } else {
                        alert("Hiba t√∂rt√©nt a ment√©s sor√°n!");
                    }
                });
        });

        // T√∂rl√©s (DELETE)
        function deleteProduct(id) {
            if(confirm('Biztosan t√∂r√∂lni szeretn√©d ezt a term√©ket?')) {
                fetch(`/api/aruk/${id}`, {
                    method: 'DELETE'
                })
                    .then(response => {
                        if (response.ok) {
                            refreshList();
                        } else {
                            alert("Hiba a t√∂rl√©sn√©l!");
                        }
                    });
            }
        }
    </script>
</div>

</body>
</html>